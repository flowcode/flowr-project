{% extends "FlowerCoreBundle::layout.html.twig" %}

{% block title %}{{ '%entity% edit'|trans({'%entity%': 'Project'}, 'Project') }} - {{ parent() }}{% endblock %}

{% block app_menu %}
    {{ include("FlowerProjectBundle::appnav.html.twig", { 'app_project_list': true }) }}
{% endblock %}

{% block body %}
    <section class="content-header">
        <h1>{{ iteration.project|title }}</h1>
    </section>
    <section class="content">
        <div class="box">
            <div class="box-header">
                <h3 class="box-title">
                    {{ iteration|title }}
                </h3>
                <div class="box-tools">
                    <a href="{{ path('project_iteration_edit', {'id':iteration.id}) }}">
                        {{ 'edit'|trans }}
                    </a>
                </div>
                <p>
                    Project:
                    <small>
                        <a href="{{ path('project_show', { 'id': iteration.project.id }) }}">
                            {{ iteration.project|title }}
                        </a>
                    </small>
                </p>
                <p>
                    Start on {{ iteration.startDate|date('y/m/d') }}, end on {{ iteration.dueDate|date('y/m/d') }}.
                </p>
            </div>
            <div class="box-body">
                <div class="row">
                    <div class="col-sm-12">
                        <h4>
                            {{ 'views'|trans|title }}
                        </h4>
                        <ul class="list-inline">
                            {% for filter in iteration.taskFilters %}
                                <li>
                                    <a href="{{ path('project_board_task_kanban', {'project_id': iteration.project.id, 'task_filter_id':filter.id}) }}">
                                        {{ filter.name }}
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                        <a href="{{ path('board_new_to_project_iteration', {'id': iteration.id }) }}"
                           class="btn btn-linl btn-xs">
                            <i class="ionicons ion-ios-plus-empty"></i> Add
                        </a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6">
                        <h4>{{ 'tasks'|trans|title }}</h4>
                        <table class="table table-condensed">
                            <thead>
                            <tr>
                                <th>{{ 'name' }}</th>
                                <th>{{ 'status' }}</th>
                                <th>{{ 'estimated' }}</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for task in iteration.tasks %}
                                <tr>
                                    <td>
                                        <a href="{{ path('task_show', {'id':task.id}) }}">
                                            {{ task.name|title }}
                                        </a>
                                    </td>
                                    <td>
                                        <span>{{ task.status }}</span>
                                    </td>
                                    <td>
                                        <span>{{ task.estimated }}</span>
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="col-sm-6">
                        <h4>Burndown</h4>
                        <div>
                            <canvas id="burndownChart" height="300"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="box-footer">
            </div>
        </div>
    </section>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/flowercore/js/plugins/chartjs/Chart.js') }}" type="text/javascript"></script>
    <script type="text/javascript">
        var lineChart;

        var areaChartData = {
            labels: {{ burndownPeriod|json_encode(constant('JSON_PRETTY_PRINT'))|raw }},
            datasets: [{{ burndown|json_encode(constant('JSON_PRETTY_PRINT'))|raw }}]
        };

        $(function () {

            var lineChartOptions = {
                showScale: true,
                scaleShowGridLines: false,
                scaleGridLineColor: "rgba(0,0,0,.05)",
                scaleGridLineWidth: 1,
                scaleShowHorizontalLines: true,
                scaleShowVerticalLines: true,
                bezierCurve: true,
                bezierCurveTension: 0.3,
                pointDot: true,
                pointDotRadius: 4,
                pointDotStrokeWidth: 1,
                pointHitDetectionRadius: 20,
                datasetStroke: false,
                datasetStrokeWidth: 2,
                datasetFill: false,
                maintainAspectRatio: false,
                responsive: true,
                legendTemplate: '<ul class="list-unstyled <%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){ %><li><span style=\"background-color:<%=datasets[i].strokeColor%>\"></span><%if(datasets[i].label){ %><%=datasets[i].label%><% }%></li><%}%></ul>'
            };

            var lineChartCanvas = $("#burndownChart").get(0).getContext("2d");
            lineChart = new Chart(lineChartCanvas).Line(areaChartData, lineChartOptions);

        });
    </script>
{% endblock %}
